import { 
  users, type User, type InsertUser,
  categories, type Category, type InsertCategory,
  articles, type Article, type InsertArticle,
  workshops, type Workshop, type InsertWorkshop,
  events, type Event, type InsertEvent,
  tags, type Tag, type InsertTag,
  subscribers, type Subscriber, type InsertSubscriber
} from "@shared/schema";
import { format } from "date-fns";

// Interface for storage operations
export interface IStorage {
  // Users
  getUser(id: number): Promise<User | undefined>;
  getUserByUsername(username: string): Promise<User | undefined>;
  createUser(user: InsertUser): Promise<User>;
  
  // Categories
  getAllCategories(): Promise<Category[]>;
  getCategoryBySlug(slug: string): Promise<Category | undefined>;
  createCategory(category: InsertCategory): Promise<Category>;
  
  // Articles
  getAllArticles(limit?: number, offset?: number): Promise<Article[]>;
  getArticleById(id: number): Promise<Article | undefined>;
  getArticleBySlug(slug: string): Promise<Article | undefined>;
  getArticlesByCategory(categoryId: number, limit?: number, offset?: number): Promise<Article[]>;
  getFeaturedArticles(limit?: number): Promise<Article[]>;
  getPopularArticles(limit?: number): Promise<Article[]>;
  getLatestArticles(limit?: number): Promise<Article[]>;
  createArticle(article: InsertArticle): Promise<Article>;
  incrementArticleReadCount(id: number): Promise<Article | undefined>;
  searchArticles(query: string, limit?: number): Promise<Article[]>;
  
  // Workshops
  getAllWorkshops(limit?: number): Promise<Workshop[]>;
  getWorkshopBySlug(slug: string): Promise<Workshop | undefined>;
  getFeaturedWorkshops(limit?: number): Promise<Workshop[]>;
  createWorkshop(workshop: InsertWorkshop): Promise<Workshop>;
  
  // Events
  getAllEvents(limit?: number): Promise<Event[]>;
  getUpcomingEvents(limit?: number): Promise<Event[]>;
  createEvent(event: InsertEvent): Promise<Event>;
  
  // Tags
  getAllTags(): Promise<Tag[]>;
  getPopularTags(limit?: number): Promise<Tag[]>;
  createTag(tag: InsertTag): Promise<Tag>;
  
  // Subscribers
  createSubscriber(subscriber: InsertSubscriber): Promise<Subscriber>;
}

export class MemStorage implements IStorage {
  private users: Map<number, User>;
  private categories: Map<number, Category>;
  private articles: Map<number, Article>;
  private workshops: Map<number, Workshop>;
  private events: Map<number, Event>;
  private tags: Map<number, Tag>;
  private subscribers: Map<number, Subscriber>;
  
  // Auto-increment IDs
  private userCurrentId: number;
  private categoryCurrentId: number;
  private articleCurrentId: number;
  private workshopCurrentId: number;
  private eventCurrentId: number;
  private tagCurrentId: number;
  private subscriberCurrentId: number;
  
  constructor() {
    this.users = new Map();
    this.categories = new Map();
    this.articles = new Map();
    this.workshops = new Map();
    this.events = new Map();
    this.tags = new Map();
    this.subscribers = new Map();
    
    this.userCurrentId = 1;
    this.categoryCurrentId = 1;
    this.articleCurrentId = 1;
    this.workshopCurrentId = 1;
    this.eventCurrentId = 1;
    this.tagCurrentId = 1;
    this.subscriberCurrentId = 1;
    
    // Initialize with sample data
    this.initializeData();
  }
  
  // Users
  async getUser(id: number): Promise<User | undefined> {
    return this.users.get(id);
  }
  
  async getUserByUsername(username: string): Promise<User | undefined> {
    return Array.from(this.users.values()).find(
      (user) => user.username === username,
    );
  }
  
  async createUser(insertUser: InsertUser): Promise<User> {
    const id = this.userCurrentId++;
    const user: User = { ...insertUser, id };
    this.users.set(id, user);
    return user;
  }
  
  // Categories
  async getAllCategories(): Promise<Category[]> {
    return Array.from(this.categories.values());
  }
  
  async getCategoryBySlug(slug: string): Promise<Category | undefined> {
    return Array.from(this.categories.values()).find(
      (category) => category.slug === slug,
    );
  }
  
  async createCategory(insertCategory: InsertCategory): Promise<Category> {
    const id = this.categoryCurrentId++;
    const category: Category = { ...insertCategory, id };
    this.categories.set(id, category);
    return category;
  }
  
  // Articles
  async getAllArticles(limit: number = 10, offset: number = 0): Promise<Article[]> {
    const articles = Array.from(this.articles.values())
      .sort((a, b) => new Date(b.publishedAt).getTime() - new Date(a.publishedAt).getTime());
    
    return articles.slice(offset, offset + limit);
  }
  
  async getArticleById(id: number): Promise<Article | undefined> {
    return this.articles.get(id);
  }
  
  async getArticleBySlug(slug: string): Promise<Article | undefined> {
    return Array.from(this.articles.values()).find(
      (article) => article.slug === slug,
    );
  }
  
  async getArticlesByCategory(categoryId: number, limit: number = 10, offset: number = 0): Promise<Article[]> {
    const articles = Array.from(this.articles.values())
      .filter(article => article.categoryId === categoryId)
      .sort((a, b) => new Date(b.publishedAt).getTime() - new Date(a.publishedAt).getTime());
    
    return articles.slice(offset, offset + limit);
  }
  
  async getFeaturedArticles(limit: number = 1): Promise<Article[]> {
    return Array.from(this.articles.values())
      .filter(article => article.featured)
      .sort((a, b) => new Date(b.publishedAt).getTime() - new Date(a.publishedAt).getTime())
      .slice(0, limit);
  }
  
  async getPopularArticles(limit: number = 5): Promise<Article[]> {
    return Array.from(this.articles.values())
      .sort((a, b) => b.readCount - a.readCount)
      .slice(0, limit);
  }
  
  async getLatestArticles(limit: number = 3): Promise<Article[]> {
    return Array.from(this.articles.values())
      .sort((a, b) => new Date(b.publishedAt).getTime() - new Date(a.publishedAt).getTime())
      .slice(0, limit);
  }
  
  async createArticle(insertArticle: InsertArticle): Promise<Article> {
    const id = this.articleCurrentId++;
    const article: Article = { ...insertArticle, id };
    this.articles.set(id, article);
    
    // Update category article count
    const category = this.categories.get(article.categoryId);
    if (category) {
      category.articleCount = (category.articleCount || 0) + 1;
      this.categories.set(category.id, category);
    }
    
    return article;
  }
  
  async incrementArticleReadCount(id: number): Promise<Article | undefined> {
    const article = this.articles.get(id);
    if (article) {
      article.readCount = (article.readCount || 0) + 1;
      this.articles.set(id, article);
      return article;
    }
    return undefined;
  }
  
  async searchArticles(query: string, limit: number = 10): Promise<Article[]> {
    const lowerCaseQuery = query.toLowerCase();
    return Array.from(this.articles.values())
      .filter(article => 
        article.title.toLowerCase().includes(lowerCaseQuery) || 
        article.summary.toLowerCase().includes(lowerCaseQuery) ||
        article.content.toLowerCase().includes(lowerCaseQuery)
      )
      .slice(0, limit);
  }
  
  // Workshops
  async getAllWorkshops(limit: number = 10): Promise<Workshop[]> {
    return Array.from(this.workshops.values())
      .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime())
      .slice(0, limit);
  }
  
  async getWorkshopBySlug(slug: string): Promise<Workshop | undefined> {
    return Array.from(this.workshops.values()).find(
      (workshop) => workshop.slug === slug,
    );
  }
  
  async getFeaturedWorkshops(limit: number = 3): Promise<Workshop[]> {
    return Array.from(this.workshops.values())
      .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime())
      .slice(0, limit);
  }
  
  async createWorkshop(insertWorkshop: InsertWorkshop): Promise<Workshop> {
    const id = this.workshopCurrentId++;
    const workshop: Workshop = { ...insertWorkshop, id };
    this.workshops.set(id, workshop);
    return workshop;
  }
  
  // Events
  async getAllEvents(limit: number = 10): Promise<Event[]> {
    return Array.from(this.events.values())
      .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime())
      .slice(0, limit);
  }
  
  async getUpcomingEvents(limit: number = 4): Promise<Event[]> {
    const now = new Date();
    return Array.from(this.events.values())
      .filter(event => new Date(event.date) >= now)
      .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime())
      .slice(0, limit);
  }
  
  async createEvent(insertEvent: InsertEvent): Promise<Event> {
    const id = this.eventCurrentId++;
    const event: Event = { ...insertEvent, id };
    this.events.set(id, event);
    return event;
  }
  
  // Tags
  async getAllTags(): Promise<Tag[]> {
    return Array.from(this.tags.values());
  }
  
  async getPopularTags(limit: number = 10): Promise<Tag[]> {
    return Array.from(this.tags.values()).slice(0, limit);
  }
  
  async createTag(insertTag: InsertTag): Promise<Tag> {
    const id = this.tagCurrentId++;
    const tag: Tag = { ...insertTag, id };
    this.tags.set(id, tag);
    return tag;
  }
  
  // Subscribers
  async createSubscriber(insertSubscriber: InsertSubscriber): Promise<Subscriber> {
    const id = this.subscriberCurrentId++;
    const subscriber: Subscriber = { 
      ...insertSubscriber, 
      id,
      subscribedAt: new Date()
    };
    this.subscribers.set(id, subscriber);
    return subscriber;
  }
  
  // Initialize with sample data
  private initializeData() {
    // Create sample users
    const user1 = this.createUser({ username: "admin", password: "admin" });
    
    // Create sample categories
    const categories = [
      { name: "Monta√±ismo", slug: "montanismo", articleCount: 0 },
      { name: "Senderismo", slug: "senderismo", articleCount: 0 },
      { name: "Escalada", slug: "escalada", articleCount: 0 },
      { name: "Talleres", slug: "talleres", articleCount: 0 },
      { name: "Eventos", slug: "eventos", articleCount: 0 },
      { name: "Equipamiento", slug: "equipamiento", articleCount: 0 },
      { name: "Consejos", slug: "consejos", articleCount: 0 },
    ];
    
    categories.forEach(category => {
      this.createCategory(category);
    });
    
    // Create sample articles
    const articles = [
      {
        title: "Nueva expedici√≥n al Monte Everest bate r√©cord de ascenso",
        slug: "nueva-expedicion-monte-everest-record",
        summary: "Un equipo internacional logra completar la subida en tiempo r√©cord gracias a nuevas t√©cnicas y equipamiento especializado.",
        content: `
          <p>Un equipo internacional de escaladores ha logrado lo que muchos consideraban imposible: completar la ascensi√≥n al Monte Everest en un tiempo r√©cord, gracias a la implementaci√≥n de nuevas t√©cnicas de escalada y equipamiento especializado de √∫ltima generaci√≥n.</p>
          
          <p>La expedici√≥n, liderada por el reconocido alpinista Carlos Monta√±ez, consigui√≥ alcanzar la cima en tan solo 3 d√≠as desde el campamento base, cuando normalmente este trayecto puede llevar entre 5 y 7 d√≠as en condiciones √≥ptimas.</p>
          
          <h2>Nuevas t√©cnicas y equipamiento</h2>
          
          <p>Entre las innovaciones que hicieron posible este logro destacan:</p>
          
          <ul>
            <li>Equipos de ox√≠geno m√°s ligeros y eficientes que reducen el peso transportado</li>
            <li>Trajes t√©rmicos de nueva generaci√≥n que mantienen la temperatura corporal con menos capas</li>
            <li>T√©cnicas de aclimataci√≥n r√°pida desarrolladas espec√≠ficamente para esta expedici√≥n</li>
            <li>Monitorizaci√≥n constante de signos vitales mediante sensores integrados en la ropa</li>
          </ul>
          
          <p>"Ha sido una experiencia incre√≠ble que demuestra que con la tecnolog√≠a adecuada y una preparaci√≥n f√≠sica meticulosa, podemos superar l√≠mites que cre√≠amos infranqueables", coment√≥ Monta√±ez tras su regreso al campamento base.</p>
          
          <h2>Implicaciones para futuras expediciones</h2>
          
          <p>Este logro podr√≠a tener importantes implicaciones para futuras expediciones de alta monta√±a, no solo en el Everest sino en otras cumbres de gran altitud alrededor del mundo. La reducci√≥n del tiempo de exposici√≥n a condiciones extremas disminuye significativamente los riesgos para los alpinistas.</p>
          
          <p>Sin embargo, expertos en seguridad en monta√±a advierten que este r√©cord no debe tomarse a la ligera ni intentar replicarse sin la debida preparaci√≥n y equipamiento.</p>
          
          <p>"Cada expedici√≥n debe evaluar cuidadosamente sus capacidades y condiciones. Este equipo ten√≠a a√±os de experiencia y contaba con apoyo t√©cnico excepcional", explica Mar√≠a L√≥pez, especialista en seguridad de alta monta√±a.</p>
          
          <p>La haza√±a ha sido documentada en video y formar√° parte de un documental que se estrenar√° el pr√≥ximo a√±o sobre los avances en alpinismo extremo.</p>
        `,
        imageUrl: "https://images.unsplash.com/photo-1551632811-561732d1e306?ixlib=rb-1.2.1&auto=format&fit=crop&w=1200&q=80",
        categoryId: 1,
        authorId: 1,
        authorName: "Carlos Monta√±ez",
        authorImageUrl: "https://randomuser.me/api/portraits/men/32.jpg",
        featured: true,
        publishedAt: new Date("2023-05-12"),
        readCount: 4250
      },
      {
        title: "Nueva normativa para escaladores en Parques Nacionales",
        slug: "nueva-normativa-escaladores-parques-nacionales",
        summary: "El Ministerio de Medio Ambiente ha aprobado nuevas regulaciones que afectar√°n a los escaladores en todos los Parques Nacionales.",
        content: `
          <p>El Ministerio de Medio Ambiente ha aprobado nuevas regulaciones que afectar√°n a los escaladores en todos los Parques Nacionales. Estas normativas buscan proteger el entorno natural mientras se sigue permitiendo la pr√°ctica deportiva.</p>
          
          <p>Las nuevas normas, que entrar√°n en vigor a partir del pr√≥ximo mes, establecen l√≠mites en el n√∫mero de escaladores permitidos en determinadas zonas y per√≠odos del a√±o, especialmente en √°reas con ecosistemas sensibles o durante √©pocas de nidificaci√≥n de aves.</p>
          
          <h2>Principales cambios en la normativa</h2>
          
          <ul>
            <li>Se requerir√° solicitar permiso con antelaci√≥n para escalar en determinadas zonas protegidas</li>
            <li>Limitaci√≥n del n√∫mero diario de escaladores en rutas populares</li>
            <li>Prohibici√≥n temporal de la escalada en √°reas de nidificaci√≥n durante la primavera</li>
            <li>Mayores sanciones para quienes da√±en el entorno natural o abandonen equipamiento</li>
          </ul>
          
          <p>Seg√∫n Ana Ruiz, portavoz del Ministerio: "Estas medidas buscan un equilibrio entre la conservaci√≥n y el disfrute responsable de nuestros espacios naturales. No se trata de prohibir, sino de regular para garantizar la sostenibilidad".</p>
          
          <h2>Reacciones del colectivo escalador</h2>
          
          <p>Las reacciones entre los aficionados a la escalada han sido diversas. Mientras algunas asociaciones comprenden la necesidad de proteger el medio ambiente, otras consideran que las restricciones son excesivas y podr√≠an afectar negativamente a la pr√°ctica de este deporte.</p>
          
          <p>La Federaci√≥n Espa√±ola de Deportes de Monta√±a y Escalada (FEDME) ha solicitado una reuni√≥n con el Ministerio para discutir algunos puntos de la normativa que consideran "demasiado restrictivos" y proponer alternativas que permitan compatibilizar mejor la conservaci√≥n con la actividad deportiva.</p>
          
          <p>Por su parte, grupos conservacionistas han aplaudido la medida, se√±alando que era necesaria para proteger h√°bitats fr√°giles que en algunos casos estaban sufriendo degradaci√≥n por la masificaci√≥n.</p>
        `,
        imageUrl: "https://images.unsplash.com/photo-1454496522488-7a8e488e8606?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80",
        categoryId: 3,
        authorId: 1,
        authorName: "Ana Ruiz",
        authorImageUrl: "https://randomuser.me/api/portraits/women/42.jpg",
        featured: false,
        publishedAt: new Date("2023-05-10"),
        readCount: 3800
      },
      {
        title: "Revolucionario equipamiento reduce el peso en un 40%",
        slug: "revolucionario-equipamiento-reduce-peso",
        summary: "Un fabricante espa√±ol lanza al mercado una nueva l√≠nea de equipamiento para monta√±a que reduce significativamente el peso manteniendo la resistencia y durabilidad.",
        content: `
          <p>Un fabricante espa√±ol lanza al mercado una nueva l√≠nea de equipamiento para monta√±a que reduce significativamente el peso manteniendo la resistencia y durabilidad. Los primeros tests muestran resultados prometedores.</p>
          
          <p>La empresa MontechSpain ha presentado su nueva gama "UltraLight Pro", una revolucionaria l√≠nea de equipamiento para monta√±ismo y escalada que promete reducir el peso total del equipo en hasta un 40% sin comprometer la seguridad o durabilidad.</p>
          
          <h2>Tecnolog√≠a innovadora</h2>
          
          <p>El secreto de esta reducci√≥n de peso se encuentra en el uso de nuevos materiales compuestos desarrollados originalmente para la industria aeroespacial. Estos materiales combinan fibras de carbono con pol√≠meros avanzados que ofrecen una relaci√≥n resistencia/peso nunca antes vista en equipamiento outdoor.</p>
          
          <p>"Hemos estado trabajando en esta tecnolog√≠a durante m√°s de cinco a√±os", explica Mart√≠n L√≥pez, director de innovaci√≥n de la compa√±√≠a. "El desaf√≠o no era solo reducir el peso, sino mantener o incluso mejorar los est√°ndares de seguridad y durabilidad que los monta√±istas esperan".</p>
          
          <h2>Gama completa de productos</h2>
          
          <p>La l√≠nea UltraLight Pro incluye desde crampones y piolets hasta cascos, arneses y mosquetones. Uno de los productos m√°s destacados es el nuevo casco "Aero", que con apenas 190 gramos ofrece mayor protecci√≥n contra impactos que modelos convencionales que pesan m√°s del doble.</p>
          
          <p>Los primeros en probar estos equipos han sido alpinistas profesionales, quienes han reportado no solo la ventaja obvia del menor peso, sino tambi√©n mejoras en la ergonom√≠a y facilidad de uso.</p>
          
          <h2>Precio: el √∫nico inconveniente</h2>
          
          <p>El principal obst√°culo para la adopci√≥n masiva de estos equipos ser√°, previsiblemente, su precio. La tecnolog√≠a avanzada y los materiales especiales hacen que estos productos tengan un coste significativamente mayor que sus equivalentes convencionales.</p>
          
          <p>Sin embargo, la empresa asegura que est√°n trabajando para optimizar los procesos de producci√≥n y poder ofrecer versiones m√°s asequibles en un futuro pr√≥ximo, manteniendo las ventajas principales de la reducci√≥n de peso.</p>
        `,
        imageUrl: "https://images.unsplash.com/photo-1551632811-561732d1e306?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80",
        categoryId: 6,
        authorId: 1,
        authorName: "Mart√≠n L√≥pez",
        authorImageUrl: "https://randomuser.me/api/portraits/men/15.jpg",
        featured: false,
        publishedAt: new Date("2023-05-08"),
        readCount: 3500
      },
      {
        title: "Se inauguran cinco nuevas rutas de senderismo en la Sierra",
        slug: "nuevas-rutas-senderismo-sierra",
        summary: "La Consejer√≠a de Medio Ambiente ha inaugurado cinco nuevas rutas de senderismo, ampliando as√≠ la oferta para los amantes del monta√±ismo.",
        content: `
          <p>La Consejer√≠a de Medio Ambiente ha inaugurado cinco nuevas rutas de senderismo, ampliando as√≠ la oferta para los amantes del monta√±ismo. Las rutas incluyen diferentes niveles de dificultad para todos los p√∫blicos.</p>
          
          <p>La red de senderos de la Sierra se ampl√≠a este mes con cinco nuevos recorridos que permitir√°n a los aficionados descubrir paisajes hasta ahora poco accesibles. Estas rutas, que suman m√°s de 45 kil√≥metros en total, han sido dise√±adas pensando en la diversidad de perfiles de senderistas.</p>
          
          <h2>Variedad para todos los niveles</h2>
          
          <p>Las nuevas rutas se clasifican en:</p>
          
          <ul>
            <li><strong>Sendero de los Robledales</strong>: 12 km de dificultad baja, ideal para familias con ni√±os</li>
            <li><strong>Ruta del Mirador</strong>: 8 km de dificultad media-baja con espectaculares vistas panor√°micas</li>
            <li><strong>Camino de las Cascadas</strong>: 7 km de dificultad media con paso por tres saltos de agua</li>
            <li><strong>Sendero de Altura</strong>: 10 km de dificultad alta que alcanza los 1.800 metros de altitud</li>
            <li><strong>Ruta Integral</strong>: 18 km de dificultad muy alta para senderistas experimentados</li>
          </ul>
          
          <p>Seg√∫n Elena Garc√≠a, directora del proyecto: "Hemos querido crear una oferta variada que permita desde el paseo familiar hasta el reto deportivo para monta√±eros experimentados. Todas las rutas est√°n perfectamente se√±alizadas y cuentan con paneles informativos sobre la flora y fauna local".</p>
          
          <h2>Infraestructura y conservaci√≥n</h2>
          
          <p>La habilitaci√≥n de estos senderos ha incluido la instalaci√≥n de se√±alizaci√≥n homologada, √°reas de descanso con bancos en puntos estrat√©gicos, y pasarelas de madera en zonas h√∫medas para evitar la erosi√≥n del terreno.</p>
          
          <p>Las rutas han sido dise√±adas siguiendo criterios de m√≠nimo impacto ambiental, aprovechando en su mayor√≠a caminos tradicionales y evitando atravesar zonas especialmente sensibles desde el punto de vista ecol√≥gico.</p>
          
          <p>La Consejer√≠a ha editado tambi√©n una gu√≠a gratuita con informaci√≥n detallada de cada ruta, que puede descargarse desde su web oficial o recogerse en los centros de visitantes del Parque.</p>
        `,
        imageUrl: "https://images.unsplash.com/photo-1519681393784-d120267933ba?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80",
        categoryId: 2,
        authorId: 1,
        authorName: "Elena Garc√≠a",
        authorImageUrl: "https://randomuser.me/api/portraits/women/22.jpg",
        featured: false,
        publishedAt: new Date("2023-05-05"),
        readCount: 3100
      },
      {
        title: "Descubren nueva especie de flora en los Pirineos",
        slug: "descubren-nueva-especie-flora-pirineos",
        summary: "Investigadores han identificado una nueva especie de planta resistente a condiciones extremas en alta monta√±a.",
        content: `
          <p>Un equipo de bot√°nicos de la Universidad de Barcelona ha descubierto una nueva especie de planta en los Pirineos, adaptada para sobrevivir en condiciones extremas de alta monta√±a. El hallazgo representa un importante avance para la bot√°nica de monta√±a.</p>
          
          <p>La nueva especie, bautizada como "Saxifraga pyrenensis", es una peque√±a planta que crece en grietas de rocas a m√°s de 2.500 metros de altitud y ha desarrollado mecanismos √∫nicos para resistir temperaturas extremadamente bajas y fuertes vientos.</p>
          
          <h2>Un descubrimiento inesperado</h2>
          
          <p>Lo sorprendente del hallazgo es que se produjo en una zona relativamente bien estudiada de los Pirineos. "Es asombroso que a√∫n podamos encontrar nuevas especies en √°reas que cre√≠amos conocer bien", explic√≥ la Dra. Laura Campos, quien dirigi√≥ la investigaci√≥n. "Esto nos recuerda la inmensa biodiversidad que a√∫n est√° por descubrir, incluso en nuestro entorno m√°s cercano".</p>
          
          <p>La planta pas√≥ desapercibida durante tanto tiempo debido a su peque√±o tama√±o y a que florece durante un per√≠odo muy breve a finales de verano, cuando las expediciones bot√°nicas son menos frecuentes en esa zona.</p>
          
          <h2>Caracter√≠sticas √∫nicas</h2>
          
          <p>La Saxifraga pyrenensis presenta adaptaciones fascinantes que la hacen √∫nica:</p>
          
          <ul>
            <li>Un sistema radicular extremadamente desarrollado que puede penetrar varios cent√≠metros en grietas microsc√≥picas</li>
            <li>Capacidad para entrar en estado de latencia casi total durante los meses m√°s fr√≠os</li>
            <li>Flores con pigmentos especiales que absorben la m√°xima radiaci√≥n solar posible</li>
            <li>Estructura celular resistente a la congelaci√≥n que le permite sobrevivir a temperaturas inferiores a -20¬∞C</li>
          </ul>
          
          <p>Los investigadores creen que estas adaptaciones podr√≠an tener aplicaciones en biotecnolog√≠a, especialmente en el desarrollo de cultivos m√°s resistentes a condiciones clim√°ticas extremas.</p>
          
          <h2>Conservaci√≥n prioritaria</h2>
          
          <p>El equipo ha alertado sobre la necesidad de proteger espec√≠ficamente esta especie, ya que su distribuci√≥n parece estar limitada a una zona relativamente peque√±a y podr√≠a verse amenazada por el cambio clim√°tico y el aumento del turismo de monta√±a.</p>
          
          <p>Las autoridades de los parques naturales de la zona ya han incluido la nueva especie en su cat√°logo de flora protegida y est√°n considerando medidas espec√≠ficas para garantizar su conservaci√≥n.</p>
        `,
        imageUrl: "https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80",
        categoryId: 2,
        authorId: 1,
        authorName: "Laura Campos",
        authorImageUrl: "https://randomuser.me/api/portraits/women/33.jpg",
        featured: false,
        publishedAt: new Date("2023-05-01"),
        readCount: 4200
      },
      {
        title: "Los 10 mejores miradores para fotografiar el amanecer",
        slug: "mejores-miradores-fotografiar-amanecer",
        summary: "Gu√≠a completa de los puntos m√°s espectaculares para capturar amaneceres en las monta√±as espa√±olas.",
        content: `
          <p>Si eres un aficionado a la fotograf√≠a de paisaje, capturar un amanecer desde la cumbre de una monta√±a puede ser una de las experiencias m√°s gratificantes. En este art√≠culo, te presentamos los diez mejores miradores de Espa√±a para fotografiar el alba desde las alturas.</p>
          
          <h2>1. Pico del Teide (Tenerife)</h2>
          
          <p>A 3.718 metros de altura, el amanecer desde el Teide ofrece una vista incomparable sobre el "mar de nubes" y la sombra proyectada del volc√°n sobre el oc√©ano. Es necesario solicitar un permiso especial para acceder a la cumbre al amanecer.</p>
          
          <h2>2. La Pedriza (Madrid)</h2>
          
          <p>Este enclave gran√≠tico en la Sierra de Guadarrama ofrece varias ubicaciones excelentes para fotografiar el amanecer, como el Yelmo o las Torres. La luz dorada iluminando las peculiares formaciones rocosas crea escenas de gran belleza.</p>
          
          <h2>3. Puig Major (Mallorca)</h2>
          
          <p>Aunque la cumbre en s√≠ est√° restringida por instalaciones militares, los miradores cercanos ofrecen vistas espectaculares del amanecer sobre el Mediterr√°neo y la Sierra de Tramuntana.</p>
          
          <h2>4. Pico Urriellu o Naranjo de Bulnes (Asturias)</h2>
          
          <p>La imagen del primer sol iluminando esta emblem√°tica cumbre de los Picos de Europa es un cl√°sico de la fotograf√≠a de monta√±a. El refugio de Urriellu es un buen punto de partida.</p>
          
          <h2>5. Montsant (Tarragona)</h2>
          
          <p>Esta sierra ofrece panor√°micas excepcionales del amanecer sobre el mar de vi√±edos del Priorat. La Roca Corbatera es uno de los mejores puntos para los fot√≥grafos.</p>
          
          <h2>6. Ordesa y Monte Perdido (Huesca)</h2>
          
          <p>El mirador de Calcilarruego permite contemplar c√≥mo los primeros rayos del sol iluminan progresivamente las paredes del impresionante Valle de Ordesa.</p>
          
          <h2>7. Sierra Nevada (Granada)</h2>
          
          <p>Desde el Veleta o el Mulhac√©n, los dos picos m√°s altos de la pen√≠nsula, se puede fotografiar el amanecer con √Åfrica y el Mediterr√°neo como tel√≥n de fondo en d√≠as despejados.</p>
          
          <h2>8. Montserrat (Barcelona)</h2>
          
          <p>Las peculiares formaciones rocosas de esta monta√±a crean siluetas √∫nicas contra el cielo del amanecer. Sant Jeroni ofrece una de las mejores perspectivas.</p>
          
          <h2>9. Picos de Urbi√≥n (Soria)</h2>
          
          <p>El amanecer en la Laguna Negra o desde el pico Urbi√≥n proporciona escenas m√≠sticas, especialmente en oto√±o cuando la niebla suele cubrir los bosques circundantes.</p>
          
          <h2>10. Aneto (Huesca)</h2>
          
          <p>El techo de los Pirineos ofrece una vista privilegiada del amanecer sobre toda la cordillera. Si tienes suerte, podr√°s fotografiar el fen√≥meno conocido como "rayo verde" justo cuando el sol asoma por el horizonte.</p>
          
          <h2>Consejos pr√°cticos para la fotograf√≠a de amanecer en monta√±a</h2>
          
          <ul>
            <li>Llega al punto elegido al menos 30 minutos antes de la hora oficial del amanecer</li>
            <li>Lleva tr√≠pode para las tomas con poca luz</li>
            <li>No te olvides de una linterna frontal para el ascenso nocturno</li>
            <li>Incluye filtros degradados para equilibrar la exposici√≥n entre el cielo y el terreno</li>
            <li>Recuerda que la temperatura ser√° significativamente m√°s baja al amanecer, viste por capas</li>
          </ul>
          
          <p>Fotografiar amaneceres en monta√±a requiere esfuerzo y planificaci√≥n, pero las im√°genes resultantes bien merecen madrugar y afrontar temperaturas fr√≠as. ¬°Comparte tus capturas con nosotros!</p>
        `,
        imageUrl: "https://images.unsplash.com/photo-1483728642387-6c3bdd6c93e5?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80",
        categoryId: 2,
        authorId: 1,
        authorName: "Pablo Serrano",
        authorImageUrl: "https://randomuser.me/api/portraits/men/44.jpg",
        featured: false,
        publishedAt: new Date("2023-04-28"),
        readCount: 3800
      },
      {
        title: "Gu√≠a definitiva de supervivencia en monta√±a",
        slug: "guia-supervivencia-montana",
        summary: "Aprende las t√©cnicas y conocimientos esenciales para afrontar situaciones de emergencia en entornos monta√±osos.",
        content: `
          <p>La monta√±a es un entorno tan hermoso como imprevisible. Incluso los excursionistas m√°s experimentados pueden encontrarse en situaciones de emergencia debido a cambios meteorol√≥gicos repentinos, accidentes o desorientaci√≥n. Esta gu√≠a proporciona los conocimientos b√°sicos que todo aficionado a la monta√±a deber√≠a dominar.</p>
          
          <h2>Preparaci√≥n: la clave de la supervivencia</h2>
          
          <p>La mejor estrategia de supervivencia es la prevenci√≥n. Antes de cualquier salida:</p>
          
          <ul>
            <li>Estudia la ruta y familiar√≠zate con el terreno mediante mapas actualizados</li>
            <li>Consulta varias fuentes de previsi√≥n meteorol√≥gica espec√≠ficas para monta√±a</li>
            <li>Informa a terceros sobre tu itinerario y hora prevista de regreso</li>
            <li>Comprueba el estado y funcionamiento de todo tu equipo</li>
            <li>Adapta la ruta a la experiencia y capacidad f√≠sica del miembro menos preparado del grupo</li>
          </ul>
          
          <h2>El kit esencial de supervivencia</h2>
          
          <p>Adem√°s del equipamiento habitual, un peque√±o kit de supervivencia no ocupa mucho espacio y puede marcar la diferencia:</p>
          
          <ul>
            <li>Navaja multiusos de calidad</li>
            <li>Encendedor y cerillas resistentes al agua</li>
            <li>Br√∫jula (no conf√≠es √∫nicamente en dispositivos electr√≥nicos)</li>
            <li>Silbato (su sonido alcanza mayor distancia que la voz humana)</li>
            <li>Manta t√©rmica</li>
            <li>Kit b√°sico de primeros auxilios</li>
            <li>Pastillas potabilizadoras de agua</li>
            <li>Cordino de paracord (resistente y multiuso)</li>
            <li>Linterna frontal con bater√≠as de repuesto</li>
            <li>Raciones de emergencia (barritas energ√©ticas de larga duraci√≥n)</li>
          </ul>
          
          <h2>Si te pierdes: protocolo STOP</h2>
          
          <p>En caso de desorientaci√≥n, sigue el protocolo STOP:</p>
          
          <ul>
            <li><strong>S</strong>top (Detente): No sigas caminando al azar, solo empeorar√°s la situaci√≥n</li>
            <li><strong>T</strong>hink (Piensa): Mant√©n la calma y eval√∫a tu situaci√≥n objetivamente</li>
            <li><strong>O</strong>bserve (Observa): Utiliza mapas, referencias visuales y la br√∫jula para ubicarte</li>
            <li><strong>P</strong>lan (Planifica): Decide tu mejor curso de acci√≥n bas√°ndote en la informaci√≥n disponible</li>
          </ul>
          
          <h2>Construcci√≥n de refugios improvisados</h2>
          
          <p>Un refugio adecuado te proteger√° de la hipotermia, principal causa de muerte en situaciones de supervivencia en monta√±a. Algunos refugios b√°sicos que puedes construir:</p>
          
          <ul>
            <li><strong>Refugio de manta t√©rmica</strong>: Utiliza cordino para tensar la manta entre √°rboles o rocas, creando un techo impermeable</li>
            <li><strong>Aprovecha cuevas naturales</strong>: Pero comprueba primero que no est√©n habitadas por animales</li>
            <li><strong>Refugio de nieve</strong>: En condiciones invernales, un hoyo en la nieve cubierto con ramas puede proporcionar un aislamiento sorprendentemente bueno</li>
          </ul>
          
          <h2>Obtenci√≥n de agua</h2>
          
          <p>Puedes sobrevivir semanas sin comida, pero solo d√≠as sin agua. Si agotas tus reservas:</p>
          
          <ul>
            <li>Busca agua en zonas de vegetaci√≥n abundante</li>
            <li>Recoge agua de lluvia con tu manta t√©rmica</li>
            <li>Sigue el vuelo de p√°jaros al amanecer o atardecer, suelen dirigirse a fuentes de agua</li>
            <li>Derrite nieve o hielo (pero nunca los consumas directamente, causan hipotermia)</li>
            <li>Siempre potabiliza el agua mediante ebullici√≥n o pastillas potabilizadoras</li>
          </ul>
          
          <h2>Se√±ales internacionales de socorro</h2>
          
          <p>Para comunicar tu situaci√≥n de emergencia:</p>
          
          <ul>
            <li><strong>Se√±al visual o ac√∫stica</strong>: Seis se√±ales en un minuto, pausa de un minuto, repetir</li>
            <li><strong>Con linterna o espejo</strong>: Tres destellos cortos, tres largos, tres cortos (c√≥digo SOS)</li>
            <li><strong>Con silbato</strong>: Tres pitidos cortos, pausa, repetir</li>
            <li><strong>Se√±al en el suelo</strong>: Forma una X grande con materiales contrastantes</li>
          </ul>
          
          <p>Recuerda que la mejor supervivencia es aquella que nunca necesitas poner en pr√°ctica. La planificaci√≥n, el equipamiento adecuado y la prudencia son tus mejores aliados en la monta√±a.</p>
        `,
        imageUrl: "https://images.unsplash.com/photo-1533240332313-0db49b459ad6?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80",
        categoryId: 7,
        authorId: 1,
        authorName: "Ricardo Montero",
        authorImageUrl: "https://randomuser.me/api/portraits/men/55.jpg",
        featured: false,
        publishedAt: new Date("2023-04-25"),
        readCount: 3500
      }
    ];
    
    articles.forEach(article => {
      this.createArticle(article);
    });
    
    // Create sample workshops
    const workshops = [
      {
        title: "Taller de escalada avanzada",
        slug: "taller-escalada-avanzada",
        description: "Aprende t√©cnicas avanzadas de escalada con expertos del sector.",
        imageUrl: "https://images.unsplash.com/photo-1551632811-561732d1e306?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80",
        date: new Date("2023-05-15"),
        startTime: "10:00",
        endTime: "17:00",
        price: 45,
        availableSpots: 5,
        location: "Centro de Escalada Urbana, Madrid"
      },
      {
        title: "Curso de supervivencia",
        slug: "curso-supervivencia",
        description: "Aprende habilidades esenciales para sobrevivir en la naturaleza.",
        imageUrl: "https://images.unsplash.com/photo-1519904981063-b0cf448d479e?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80",
        date: new Date("2023-05-20"),
        startTime: "09:00",
        endTime: "18:00",
        price: 75,
        availableSpots: 2,
        location: "Sierra de Guadarrama, Madrid"
      },
      {
        title: "Fotograf√≠a de naturaleza",
        slug: "fotografia-naturaleza",
        description: "Captura la belleza de la naturaleza con nuestro taller pr√°ctico.",
        imageUrl: "https://images.unsplash.com/photo-1520962880247-cfaf541c8724?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80",
        date: new Date("2023-05-18"),
        startTime: "14:00",
        endTime: "19:00",
        price: 35,
        availableSpots: 0,
        location: "Parque Nacional Sierra de Guadarrama"
      }
    ];
    
    workshops.forEach(workshop => {
      this.createWorkshop(workshop);
    });
    
    // Create sample events
    const events = [
      {
        title: "Marat√≥n de Monta√±a Sierra Norte",
        description: "Competici√≥n de resistencia por los senderos m√°s desafiantes de la Sierra Norte.",
        date: new Date("2023-05-22"),
        location: "Sierra Norte, Madrid",
        price: "A partir de 25‚Ç¨",
        buttonText: "Inscribirse",
        buttonAction: "register",
        borderColor: "#ED8936" // accent
      },
      {
        title: "Feria del Equipamiento Outdoor",
        description: "Las √∫ltimas novedades en equipamiento para actividades al aire libre.",
        date: new Date("2023-05-28"),
        location: "IFEMA, Madrid",
        price: "Entrada gratuita",
        buttonText: "M√°s informaci√≥n",
        buttonAction: "info",
        borderColor: "#2B6CB0" // primary
      },
      {
        title: "D√≠a Mundial del Medio Ambiente",
        description: "Jornada de limpieza y concienciaci√≥n en espacios naturales.",
        date: new Date("2023-06-05"),
        location: "Varios puntos de Espa√±a",
        price: "Participaci√≥n voluntaria",
        buttonText: "Participar",
        buttonAction: "participate",
        borderColor: "#48BB78" // secondary
      },
      {
        title: "Encuentro de Escaladores",
        description: "Comparte experiencias con otros escaladores y aprende nuevas t√©cnicas.",
        date: new Date("2023-06-12"),
        location: "La Pedriza, Madrid",
        price: "10‚Ç¨ (incluye comida)",
        buttonText: "Inscribirse",
        buttonAction: "register",
        borderColor: "#ED8936" // accent
      }
    ];
    
    events.forEach(event => {
      this.createEvent(event);
    });
    
    // Create sample tags
    const tags = [
      { name: "Monta√±ismo", slug: "montanismo" },
      { name: "Escalada", slug: "escalada" },
      { name: "Equipamiento", slug: "equipamiento" },
      { name: "Senderismo", slug: "senderismo" },
      { name: "Supervivencia", slug: "supervivencia" },
      { name: "Fotograf√≠a", slug: "fotografia" },
      { name: "Pirineos", slug: "pirineos" },
      { name: "SierraNevada", slug: "sierra-nevada" },
      { name: "Acampada", slug: "acampada" },
      { name: "Everest", slug: "everest" },
      { name: "MedioAmbiente", slug: "medio-ambiente" }
    ];
    
    tags.forEach(tag => {
      this.createTag(tag);
    });
  }
}

export const storage = new MemStorage();
